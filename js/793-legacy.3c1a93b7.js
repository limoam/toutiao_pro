(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[793],{4793:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return g}});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"article-detail"},[n("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:"",title:"文章详情","left-arrow":"",border:!1},on:{"click-left":function(e){return t.$router.back()}}}),0!==Object.keys(t.artObj).length?n("div",[n("div",{staticClass:"article-container"},[n("h1",{staticClass:"art-title"},[t._v(t._s(t.artObj.title))]),n("van-cell",{attrs:{center:"",title:t.artObj.aut_name,label:t._f("relativeTime")(t.artObj.pubdate)},scopedSlots:t._u([{key:"icon",fn:function(){return[n("img",{staticClass:"avatar",attrs:{src:t.artObj.aut_photo,alt:""}})]},proxy:!0},{key:"default",fn:function(){return[n("div",[t.artObj.is_followed?n("van-button",{attrs:{type:"info",size:"mini"},on:{click:function(e){return t.followFn(!1)}}},[t._v("已关注")]):n("van-button",{attrs:{icon:"plus",type:"info",size:"mini",plain:""},on:{click:function(e){return t.followFn(!0)}}},[t._v("关注")])],1)]},proxy:!0}],null,!1,3681198566)}),n("van-divider"),n("div",{staticClass:"art-content",domProps:{innerHTML:t._s(t.artObj.content)}}),n("van-divider",[t._v("End")]),n("div",{staticClass:"like-box"},[1===t.artObj.attitude?n("van-button",{attrs:{icon:"good-job",type:"danger",size:"small"},on:{click:function(e){return t.attitudeFn(0)}}},[t._v("已点赞")]):n("van-button",{attrs:{icon:"good-job-o",type:"danger",plain:"",size:"small"},on:{click:function(e){return t.attitudeFn(1)}}},[t._v("点赞")])],1)],1),n("div",[n("CommentList")],1)]):n("van-loading",{attrs:{type:"spinner",color:"#1989fa"}},[t._v("加载中. . .")])],1)},a=[],i=n(6198),o=(n(8975),n(4234)),c=n(6165),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"cmt-list"},[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多评论了，请发表评论","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.commentArr,(function(e){return n("div",{key:e.com_id,staticClass:"cmt-item"},[n("div",{staticClass:"cmt-header"},[n("div",{staticClass:"cmt-header-left"},[n("img",{staticClass:"avatar",attrs:{src:e.aut_photo}}),n("span",{staticClass:"uname"},[t._v(t._s(e.aut_name))])]),n("div",{staticClass:"cmt-header-right"},[e.is_liking?n("van-icon",{attrs:{name:"like",size:"16",color:"red"},on:{click:function(n){return t.islove(e,!1)}}}):n("van-icon",{attrs:{name:"like-o",size:"16",color:"gray"},on:{click:function(n){return t.islove(e,!0)}}})],1)]),n("div",{staticClass:"cmt-body",domProps:{innerHTML:t._s(e.content)}}),n("div",{staticClass:"cmt-footer"},[t._v(t._s(t._f("relativeTime")(e.pubdate)))])])})),0)],1),t.isShowCmtIpt?n("div",{staticClass:"cmt-box van-hairline--top"},[n("textarea",{directives:[{name:"fofo",rawName:"v-fofo"},{name:"model",rawName:"v-model.trim",value:t.comText,expression:"comText",modifiers:{trim:!0}}],attrs:{placeholder:"友善评论、理性发言、阳光心灵"},domProps:{value:t.comText},on:{blur:[t.blurFn,function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||(t.comText=e.target.value.trim())}}}),n("van-button",{attrs:{type:"default",disabled:0===t.comText.length},on:{click:t.sendFn}},[t._v("发布")])],1):n("div",{staticClass:"add-cmt-box van-hairline--top"},[n("van-icon",{attrs:{name:"arrow-left",size:"0.48rem"},on:{click:function(e){return t.$router.back()}}}),n("div",{staticClass:"ipt-cmt-div",on:{click:t.toggleShowFn}},[t._v("发表评论")]),n("div",{staticClass:"icon-box"},[n("van-badge",{attrs:{content:0===t.total_count?"":t.total_count,max:"99"}},[n("van-icon",{attrs:{name:"comment-o",size:"0.53333334rem"},on:{click:t.commentFn}})],1),n("van-icon",{attrs:{name:"star-o",size:"0.53333334rem"}}),n("van-icon",{attrs:{name:"share-o",size:"0.53333334rem"}})],1)],1)])},u=[],l=n(4479),d=(n(2222),{name:"CommentList",data:function(){return{offset:null,commentArr:[],isShowCmtIpt:!1,total_count:0,comText:"",loading:!1,finished:!1,lastId:""}},created:function(){var t=this;return(0,i.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.jS)({id:t.$route.query.art_id});case 2:n=e.sent,r=n.data,t.commentArr=r.data.results,t.total_count=r.data.total_count,t.lastId=r.data.last_id,0===r.data.results.length&&(t.finished=!0);case 8:case"end":return e.stop()}}),e)})))()},methods:{islove:function(t,e){return(0,i.Z)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.is_liking=e,!e){n.next=6;break}return n.next=4,(0,o.wR)(t.com_id);case 4:n.next=8;break;case 6:return n.next=8,(0,o.ih)(t.com_id);case 8:case"end":return n.stop()}}),n)})))()},toggleShowFn:function(){this.isShowCmtIpt=!this.isShowCmtIpt},commentFn:function(){document.querySelector(".like-box").scrollIntoView({behavior:"smooth"})},sendFn:function(){var t=this;return(0,i.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.IJ)({id:t.$route.query.art_id,content:t.comText});case 2:n=e.sent,r=n.data,t.total_count++,t.commentArr.unshift(r.data.new_obj),t.comText="",t.commentFn();case 8:case"end":return e.stop()}}),e)})))()},blurFn:function(){var t=this;setTimeout((function(){t.isShowCmtIpt=!1}),0)},onLoad:function(){var t=this;return(0,i.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.commentArr.length>0)){e.next=12;break}return e.next=3,(0,o.jS)({id:t.$route.query.art_id,offset:t.lastId});case 3:n=e.sent,r=n.data,t.commentArr=[].concat((0,l.Z)(t.commentArr),(0,l.Z)(r.data.results)),t.total_count=r.data.total_count,t.lastId=r.data.last_id,t.loading=!1,null===r.data.last_id&&(t.finished=!0),e.next=13;break;case 12:t.loading=!1;case 13:case"end":return e.stop()}}),e)})))()}}}),m=d,f=n(1001),v=(0,f.Z)(m,s,u,!1,null,"a6c8cb3a",null),p=v.exports,_={name:"ArticleDetail",props:{art_id:{type:String,required:!0}},data:function(){return{artObj:{}}},created:function(){var t=this;return(0,i.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.mx)(t.art_id);case 2:n=e.sent,r=n.data,t.artObj=r.data;case 5:case"end":return e.stop()}}),e)})))()},methods:{followFn:function(t){var e=this;return(0,i.Z)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.artObj.is_followed=t,!t){n.next=6;break}return n.next=4,(0,c.P_)(e.artObj.aut_id);case 4:n.next=8;break;case 6:return n.next=8,(0,c.wQ)(e.artObj.aut_id);case 8:case"end":return n.stop()}}),n)})))()},attitudeFn:function(t){var e=this;return(0,i.Z)(regeneratorRuntime.mark((function n(){var r,a,i,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.artObj.attitude=t,!t){n.next=9;break}return n.next=4,(0,o.HA)(e.artObj.art_id);case 4:r=n.sent,a=r.data,console.log(a),n.next=14;break;case 9:return n.next=11,(0,o.Id)(e.artObj.art_id);case 11:i=n.sent,c=i.data,console.log(c);case 14:case"end":return n.stop()}}),n)})))()}},components:{CommentList:p}},h=_,b=(0,f.Z)(h,r,a,!1,null,"0356879a",null),g=b.exports},1038:function(t,e,n){var r=n(2109),a=n(8457),i=n(7072),o=!i((function(t){Array.from(t)}));r({target:"Array",stat:!0,forced:o},{from:a})},4234:function(t,e,n){"use strict";n.d(e,{HA:function(){return s},IJ:function(){return d},Id:function(){return u},X:function(){return o},Zz:function(){return a},ih:function(){return f},jS:function(){return l},mx:function(){return c},tH:function(){return i},wR:function(){return m}});var r=n(5972),a=function(t){return r.Z.get("/v1_0/articles",{params:t})},i=function(t){return r.Z.post("/v1_0/article/dislikes",{target:t})},o=function(t){return r.Z.post("/v1_0/article/reports",t)},c=function(t){return r.Z.get("/v1_0/articles/".concat(t))},s=function(t){return r.Z.post("/v1_0/article/likings",{target:t})},u=function(t){return r.Z["delete"]("/v1_0/article/likings/".concat(t))},l=function(t){var e=t.id,n=t.offset,a=void 0===n?null:n,i=t.limit,o=void 0===i?10:i;return r.Z.get("/v1_0/comments",{params:{type:"a",source:e,offset:a,limit:o}})},d=function(t){var e=t.id,n=t.content,a=t.artId,i=void 0===a?null:a,o={target:e,content:n,art_id:i};return i||(o.art_id=i),r.Z.post("/v1_0/comments",o)},m=function(t){return r.Z.post("/v1_0/comment/likings",{target:t})},f=function(t){return r.Z["delete"]("/v1_0/comment/likings/".concat(t))}},4479:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t){if(Array.isArray(t))return r(t)}n.d(e,{Z:function(){return s}});n(2526),n(1817),n(1539),n(2165),n(8783),n(3948),n(1038);function i(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n(7042),n(8309),n(4916),n(7601);function o(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}n(1703);function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t){return a(t)||i(t)||o(t)||c()}}}]);
//# sourceMappingURL=793-legacy.3c1a93b7.js.map