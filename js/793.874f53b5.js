"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[793],{4793:function(t,a,i){i.r(a),i.d(a,{default:function(){return p}});var n=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"article-detail"},[i("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:"",title:"文章详情","left-arrow":"",border:!1},on:{"click-left":function(a){return t.$router.back()}}}),0!==Object.keys(t.artObj).length?i("div",[i("div",{staticClass:"article-container"},[i("h1",{staticClass:"art-title"},[t._v(t._s(t.artObj.title))]),i("van-cell",{attrs:{center:"",title:t.artObj.aut_name,label:t._f("relativeTime")(t.artObj.pubdate)},scopedSlots:t._u([{key:"icon",fn:function(){return[i("img",{staticClass:"avatar",attrs:{src:t.artObj.aut_photo,alt:""}})]},proxy:!0},{key:"default",fn:function(){return[i("div",[t.artObj.is_followed?i("van-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){return t.followFn(!1)}}},[t._v("已关注")]):i("van-button",{attrs:{icon:"plus",type:"info",size:"mini",plain:""},on:{click:function(a){return t.followFn(!0)}}},[t._v("关注")])],1)]},proxy:!0}],null,!1,3681198566)}),i("van-divider"),i("div",{staticClass:"art-content",domProps:{innerHTML:t._s(t.artObj.content)}}),i("van-divider",[t._v("End")]),i("div",{staticClass:"like-box"},[1===t.artObj.attitude?i("van-button",{attrs:{icon:"good-job",type:"danger",size:"small"},on:{click:function(a){return t.attitudeFn(0)}}},[t._v("已点赞")]):i("van-button",{attrs:{icon:"good-job-o",type:"danger",plain:"",size:"small"},on:{click:function(a){return t.attitudeFn(1)}}},[t._v("点赞")])],1)],1),i("div",[i("CommentList")],1)]):i("van-loading",{attrs:{type:"spinner",color:"#1989fa"}},[t._v("加载中. . .")])],1)},e=[],o=i(4234),s=i(6165),r=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",[i("div",{staticClass:"cmt-list"},[i("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多评论了，请发表评论","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(a){t.loading=a},expression:"loading"}},t._l(t.commentArr,(function(a){return i("div",{key:a.com_id,staticClass:"cmt-item"},[i("div",{staticClass:"cmt-header"},[i("div",{staticClass:"cmt-header-left"},[i("img",{staticClass:"avatar",attrs:{src:a.aut_photo}}),i("span",{staticClass:"uname"},[t._v(t._s(a.aut_name))])]),i("div",{staticClass:"cmt-header-right"},[a.is_liking?i("van-icon",{attrs:{name:"like",size:"16",color:"red"},on:{click:function(i){return t.islove(a,!1)}}}):i("van-icon",{attrs:{name:"like-o",size:"16",color:"gray"},on:{click:function(i){return t.islove(a,!0)}}})],1)]),i("div",{staticClass:"cmt-body",domProps:{innerHTML:t._s(a.content)}}),i("div",{staticClass:"cmt-footer"},[t._v(t._s(t._f("relativeTime")(a.pubdate)))])])})),0)],1),t.isShowCmtIpt?i("div",{staticClass:"cmt-box van-hairline--top"},[i("textarea",{directives:[{name:"fofo",rawName:"v-fofo"},{name:"model",rawName:"v-model.trim",value:t.comText,expression:"comText",modifiers:{trim:!0}}],attrs:{placeholder:"友善评论、理性发言、阳光心灵"},domProps:{value:t.comText},on:{blur:[t.blurFn,function(a){return t.$forceUpdate()}],input:function(a){a.target.composing||(t.comText=a.target.value.trim())}}}),i("van-button",{attrs:{type:"default",disabled:0===t.comText.length},on:{click:t.sendFn}},[t._v("发布")])],1):i("div",{staticClass:"add-cmt-box van-hairline--top"},[i("van-icon",{attrs:{name:"arrow-left",size:"0.48rem"},on:{click:function(a){return t.$router.back()}}}),i("div",{staticClass:"ipt-cmt-div",on:{click:t.toggleShowFn}},[t._v("发表评论")]),i("div",{staticClass:"icon-box"},[i("van-badge",{attrs:{content:0===t.total_count?"":t.total_count,max:"99"}},[i("van-icon",{attrs:{name:"comment-o",size:"0.53333334rem"},on:{click:t.commentFn}})],1),i("van-icon",{attrs:{name:"star-o",size:"0.53333334rem"}}),i("van-icon",{attrs:{name:"share-o",size:"0.53333334rem"}})],1)],1)])},c=[],l={name:"CommentList",data(){return{offset:null,commentArr:[],isShowCmtIpt:!1,total_count:0,comText:"",loading:!1,finished:!1,lastId:""}},async created(){const{data:t}=await(0,o.jS)({id:this.$route.query.art_id});this.commentArr=t.data.results,this.total_count=t.data.total_count,this.lastId=t.data.last_id,0===t.data.results.length&&(this.finished=!0)},methods:{async islove(t,a){t.is_liking=a,a?await(0,o.wR)(t.com_id):await(0,o.ih)(t.com_id)},toggleShowFn(){this.isShowCmtIpt=!this.isShowCmtIpt},commentFn(){document.querySelector(".like-box").scrollIntoView({behavior:"smooth"})},async sendFn(){const{data:t}=await(0,o.IJ)({id:this.$route.query.art_id,content:this.comText});this.total_count++,this.commentArr.unshift(t.data.new_obj),this.comText="",this.commentFn()},blurFn(){setTimeout((()=>{this.isShowCmtIpt=!1}),0)},async onLoad(){if(this.commentArr.length>0){const{data:t}=await(0,o.jS)({id:this.$route.query.art_id,offset:this.lastId});this.commentArr=[...this.commentArr,...t.data.results],this.total_count=t.data.total_count,this.lastId=t.data.last_id,this.loading=!1,null===t.data.last_id&&(this.finished=!0)}else this.loading=!1}}},d=l,u=i(1001),m=(0,u.Z)(d,r,c,!1,null,"a6c8cb3a",null),v=m.exports,f={name:"ArticleDetail",props:{art_id:{type:String,required:!0}},data(){return{artObj:{}}},async created(){const{data:t}=await(0,o.mx)(this.art_id);this.artObj=t.data},methods:{async followFn(t){this.artObj.is_followed=t,t?await(0,s.P_)(this.artObj.aut_id):await(0,s.wQ)(this.artObj.aut_id)},async attitudeFn(t){if(this.artObj.attitude=t,t){const{data:t}=await(0,o.HA)(this.artObj.art_id);console.log(t)}else{const{data:t}=await(0,o.Id)(this.artObj.art_id);console.log(t)}}},components:{CommentList:v}},h=f,_=(0,u.Z)(h,n,e,!1,null,"0356879a",null),p=_.exports},4234:function(t,a,i){i.d(a,{HA:function(){return c},IJ:function(){return u},Id:function(){return l},X:function(){return s},Zz:function(){return e},ih:function(){return v},jS:function(){return d},mx:function(){return r},tH:function(){return o},wR:function(){return m}});var n=i(5972);const e=t=>n.Z.get("/v1_0/articles",{params:t}),o=t=>n.Z.post("/v1_0/article/dislikes",{target:t}),s=t=>n.Z.post("/v1_0/article/reports",t),r=t=>n.Z.get(`/v1_0/articles/${t}`),c=t=>n.Z.post("/v1_0/article/likings",{target:t}),l=t=>n.Z["delete"](`/v1_0/article/likings/${t}`),d=({id:t,offset:a=null,limit:i=10})=>n.Z.get("/v1_0/comments",{params:{type:"a",source:t,offset:a,limit:i}}),u=({id:t,content:a,artId:i=null})=>{const e={target:t,content:a,art_id:i};return i||(e.art_id=i),n.Z.post("/v1_0/comments",e)},m=t=>n.Z.post("/v1_0/comment/likings",{target:t}),v=t=>n.Z["delete"](`/v1_0/comment/likings/${t}`)}}]);
//# sourceMappingURL=793.874f53b5.js.map