(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[102],{8414:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-cell",{attrs:{clickable:""}},[n("div",{staticClass:"title van-multi-ellipsis--l2",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.title))]),n("div",{attrs:{slot:"label"},slot:"label"},[3===t.article.cover.type?n("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(e,s){return n("van-image",{key:s,attrs:{fit:"cover",src:e,"lazy-load":""}},[n("van-loading",{attrs:{slot:"loading",type:"spinner",size:"20",vertical:""},slot:"loading"}),n("text",{attrs:{slot:"error"},slot:"error"},[t._v("加载失败")])],1)})),1):t._e(),n("div",{staticClass:"lable-info-wrap",class:{hide:!t.hide}},[n("span",[t._v(t._s(t.article.aut_name))]),n("span",[t._v(t._s(t.article.comm_count))]),n("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]),1===t.article.cover.type?n("van-image",{staticClass:"right-cover",attrs:{slot:"default",fit:"cover",src:t.article.cover.images[0],"lazy-load":""},slot:"default"},[n("van-loading",{attrs:{slot:"loading",type:"spinner",size:"20",vertical:""},slot:"loading"}),n("text",{attrs:{slot:"error"},slot:"error"},[t._v("加载失败")])],1):t._e(),t.hide?n("div",{staticClass:"toutiao toutiao-guanbi",attrs:{slot:"right-icon"},on:{click:function(e){e.stopPropagation(),t.show=!0}},slot:"right-icon"}):t._e()],1),n("van-action-sheet",{attrs:{actions:t.actions,"get-container":"body","cancel-text":t.bottomText,"lazy-render":""},on:{cancel:t.cancelFn,select:t.onSelect,close:t.closeFn},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}})],1)},a=[];const i=[{name:"不感兴趣"},{name:"反馈垃圾内容"}],l=[{value:0,name:"其他问题"},{value:1,name:"标题夸张"},{value:2,name:"色情低俗"},{value:3,name:"错别字多"},{value:4,name:"旧闻重复"},{value:5,name:"广告软文"},{value:6,name:"内容不实"},{value:7,name:"涉嫌违规犯罪"},{value:8,name:"侵权"}];var r=n(4234),o={name:"ArticleItem",props:{article:{type:Object,required:!0},onRefresh:Function,hide:Boolean},data(){return{show:!1,actions:i,bottomText:"取消"}},methods:{async onSelect(t){if("反馈垃圾内容"===t.name)this.actions=l,this.bottomText="返回";else if("不感兴趣"===t.name){try{await(0,r.tH)(this.article.art_id),this.$toast("将为您减少此类推荐"),this.onRefresh()}catch(e){}this.show=!1}else try{await(0,r.X)({target:this.article.art_id,type:t.value,remark:"无"}),this.$toast("感谢您的反馈"),this.show=!1,this.onRefresh()}catch(e){}},cancelFn(){"返回"===this.bottomText&&(this.show=!0,this.actions=i,this.bottomText="取消")},closeFn(){this.actions=i,this.bottomText="取消"}}},c=o,d=n(1001),h=(0,d.Z)(c,s,a,!1,null,"28300ffe",null),u=h.exports},1102:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Z}});var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home-container"},[n("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[n("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",size:"small",round:"",icon:"search"},on:{click:t.moveSearchPage},slot:"title"},[t._v("搜索")])],1),n("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(e){return n("van-tab",{key:e.id,attrs:{title:e.name}},[n("ArticleList",{attrs:{channel:e,scrollFn:t.scrollFn}})],1)})),n("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),n("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isChannelEditShow=!0}},slot:"nav-right"},[n("i",{staticClass:"toutiao toutiao-gengduo"})])],2),n("van-popup",{style:{height:"87%"},attrs:{round:"",closeable:"",position:"bottom","lazy-render":""},on:{close:t.closeFn},model:{value:t.isChannelEditShow,callback:function(e){t.isChannelEditShow=e},expression:"isChannelEditShow"}},[n("ChannelEdit",{ref:"editRef",attrs:{myChannels:t.channels,active:t.active},on:{addChannels:t.addChannels,updateChannel:t.updateChannel,delChannel:t.delChannel}})],1)],1)},a=[],i=n(6165),l=n(5972);const r=()=>l.Z.get("/v1_0/channels"),o=t=>(0,l.Z)({method:"PUT",url:"/v1_0/user/channels",data:{channels:t}}),c=t=>(0,l.Z)({method:"DELETE",url:`/v1_0/user/channels/${t}`});var d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"scrollT",staticClass:"articlelist-container",attrs:{id:"dc"+t.channel.id}},[n("van-pull-refresh",{attrs:{"success-text":t.refreshSuccess,"success-duration":1e3},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e){return n("ArticleItem",{key:e.art_id,attrs:{article:e,onRefresh:t.onRefresh,hide:!0},nativeOn:{click:function(n){return t.detailFn(e.art_id)}}})})),1)],1)],1)},h=[],u=n(4234),m=n(8414),v={name:"ArticleList",components:{ArticleItem:m.Z},props:{channel:{type:Object,required:!0},scrollFn:Function},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isLoading:!1,refreshSuccess:"刷新成功",scrollY:0}},methods:{async onLoad(){try{const{data:t}=await(0,u.Zz)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now()});this.list.push(...t.data.results),this.loading=!1,t.data.pre_timestamp?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){this.$toast("加载文章失败，稍后重试"),this.error=!0,this.loading=!1}},async onRefresh(){this.timestamp=Date.now();try{const{data:t}=await(0,u.Zz)({channel_id:this.channel.id,timestamp:this.timestamp});this.list=[],this.list=[...t.data.results],this.refreshSuccess="刷新成功",this.timestamp=t.data.pre_timestamp,this.isLoading=!1}catch(t){this.isLoading=!1,this.refreshSuccess="刷新失败"}},detailFn(t){this.$router.push({path:"/article_detail",query:{art_id:t}})},scrollFF(){this.scrollY=this.$refs.scrollT.scrollTop,this.scrollFn(this.scrollY,this.channel.id)}},mounted(){const t=this.$refs.scrollT;t.addEventListener("scroll",this.scrollFF,!0)},beforeDestroy(){const t=this.$refs.scrollT;t.removeEventListener("scroll",this.scrollFF,!0)}},f=v,p=n(1001),g=(0,p.Z)(f,d,h,!1,null,"600a79b0",null),C=g.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"channel-edit"},[n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),n("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(t._s(t.isEdit?"完成":"编辑"))])],1),n("van-grid",{staticClass:"my-grid",attrs:{"column-num":4,gutter:10}},t._l(t.myChannels,(function(e,s){return n("van-grid-item",{key:s,staticClass:"grid-item",on:{click:function(n){return t.onMychannelClick(e,s)}}},[n("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&!t.fiexChannels.includes(e.id),expression:"isEdit && !fiexChannels.includes(value.id)"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),n("span",{staticClass:"text",class:{active:s===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(e.name))])],1)})),1),n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("推荐频道")])]),n("van-grid",{staticClass:"recommend-grid",attrs:{"column-num":4,gutter:10}},t._l(t.recommendChannels,(function(e,s){return n("van-grid-item",{key:s,staticClass:"grid-item",attrs:{icon:"plus",text:e.name},on:{click:function(n){return t.onAddChannel(e)}}})})),1)],1)},y=[],b=(n(6699),{name:"ChannelEdit",props:{myChannels:{type:Array,required:!0},active:{type:Number,required:!0}},data(){return{allChannels:[],isEdit:!1,fiexChannels:[0]}},created(){this.loadAllChannels()},methods:{async loadAllChannels(){try{const{data:t}=await r();this.allChannels=t.data.channels}catch(t){console.log(t)}},onAddChannel(t){this.$emit("addChannels",t)},onMychannelClick(t,e){this.isEdit?this.fiexChannels.includes(t.id)?this.$toast("推荐无法删除"):this.$emit("delChannel",t):this.$emit("updateChannel",e)}},computed:{recommendChannels(){return this.allChannels.filter((t=>-1===this.myChannels.findIndex((e=>e.id===t.id))))}}}),w=b,x=(0,p.Z)(w,_,y,!1,null,"1177b5e5",null),k=x.exports,E={name:"HomeIndex",data(){return{active:0,channels:[],isChannelEditShow:!1,scrollNum:{}}},methods:{async loadChannels(){try{const{data:t}=await(0,i.vh)();this.channels=t.data.channels}catch(t){this.$toast("获取频道列表数据失败")}},async addChannels(t){const e=this.channels.filter((t=>0!==t.id)),n=e.map(((t,e)=>{const n={...t};return delete n.name,n.seq=e,n}));await o(n),this.channels.push(t)},updateChannel(t){this.active=t,this.isChannelEditShow=!1},async delChannel(t){const e=this.channels.findIndex((e=>t.id===e.id));this.channels.splice(e,1),await c(t.id)},closeFn(){this.$refs.editRef.isEdit=!1},moveSearchPage(){this.$router.push("/search")},scrollFn(t,e){this.scrollNum[e]=t}},created(){this.loadChannels()},activated(){if(0!==Object.keys(this.scrollNum))for(const t in this.scrollNum)document.querySelector(`#dc${t}`).scrollTop=this.scrollNum[t]},components:{ArticleList:C,ChannelEdit:k}},F=E,$=(0,p.Z)(F,s,a,!1,null,"fdbdebb4",null),Z=$.exports},1223:function(t,e,n){var s=n(5112),a=n(30),i=n(3070),l=s("unscopables"),r=Array.prototype;void 0==r[l]&&i.f(r,l,{configurable:!0,value:a(null)}),t.exports=function(t){r[l][t]=!0}},30:function(t,e,n){var s,a=n(9670),i=n(6048),l=n(748),r=n(3501),o=n(490),c=n(317),d=n(6200),h=">",u="<",m="prototype",v="script",f=d("IE_PROTO"),p=function(){},g=function(t){return u+v+h+t+u+"/"+v+h},C=function(t){t.write(g("")),t.close();var e=t.parentWindow.Object;return t=null,e},_=function(){var t,e=c("iframe"),n="java"+v+":";return e.style.display="none",o.appendChild(e),e.src=String(n),t=e.contentWindow.document,t.open(),t.write(g("document.F=Object")),t.close(),t.F},y=function(){try{s=new ActiveXObject("htmlfile")}catch(e){}y="undefined"!=typeof document?document.domain&&s?C(s):_():C(s);var t=l.length;while(t--)delete y[m][l[t]];return y()};r[f]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(p[m]=a(t),n=new p,p[m]=null,n[f]=t):n=y(),void 0===e?n:i.f(n,e)}},6048:function(t,e,n){var s=n(9781),a=n(3353),i=n(3070),l=n(9670),r=n(5656),o=n(1956);e.f=s&&!a?Object.defineProperties:function(t,e){l(t);var n,s=r(e),a=o(e),c=a.length,d=0;while(c>d)i.f(t,n=a[d++],s[n]);return t}},1956:function(t,e,n){var s=n(6324),a=n(748);t.exports=Object.keys||function(t){return s(t,a)}},6699:function(t,e,n){"use strict";var s=n(2109),a=n(1318).includes,i=n(7293),l=n(1223),r=i((function(){return!Array(1).includes()}));s({target:"Array",proto:!0,forced:r},{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),l("includes")},4234:function(t,e,n){"use strict";n.d(e,{HA:function(){return o},IJ:function(){return h},Id:function(){return c},X:function(){return l},Zz:function(){return a},ih:function(){return m},jS:function(){return d},mx:function(){return r},tH:function(){return i},wR:function(){return u}});var s=n(5972);const a=t=>s.Z.get("/v1_0/articles",{params:t}),i=t=>s.Z.post("/v1_0/article/dislikes",{target:t}),l=t=>s.Z.post("/v1_0/article/reports",t),r=t=>s.Z.get(`/v1_0/articles/${t}`),o=t=>s.Z.post("/v1_0/article/likings",{target:t}),c=t=>s.Z["delete"](`/v1_0/article/likings/${t}`),d=({id:t,offset:e=null,limit:n=10})=>s.Z.get("/v1_0/comments",{params:{type:"a",source:t,offset:e,limit:n}}),h=({id:t,content:e,artId:n=null})=>{const a={target:t,content:e,art_id:n};return n||(a.art_id=n),s.Z.post("/v1_0/comments",a)},u=t=>s.Z.post("/v1_0/comment/likings",{target:t}),m=t=>s.Z["delete"](`/v1_0/comment/likings/${t}`)}}]);
//# sourceMappingURL=102.9c970e15.js.map