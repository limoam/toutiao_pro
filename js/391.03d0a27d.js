"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[391],{2391:function(t,n,a){a.r(n),a.d(n,{default:function(){return p}});var e=function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticClass:"article-detail"},[a("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:"",title:"文章详情","left-arrow":"",border:!1},on:{"click-left":function(n){return t.$router.back()}}}),a("div",{staticClass:"article-container"},[a("h1",{staticClass:"art-title"},[t._v(t._s(t.artObj.title))]),a("van-cell",{attrs:{center:"",title:t.artObj.aut_name,label:t._f("relativeTime")(t.artObj.pubdate)},scopedSlots:t._u([{key:"icon",fn:function(){return[a("img",{staticClass:"avatar",attrs:{src:t.artObj.aut_photo,alt:""}})]},proxy:!0},{key:"default",fn:function(){return[a("div",[t.artObj.is_followed?a("van-button",{attrs:{type:"info",size:"mini"},on:{click:function(n){return t.followFn(!1)}}},[t._v("已关注")]):a("van-button",{attrs:{icon:"plus",type:"info",size:"mini",plain:""},on:{click:function(n){return t.followFn(!0)}}},[t._v("关注")])],1)]},proxy:!0}])}),a("van-divider"),a("div",{staticClass:"art-content",domProps:{innerHTML:t._s(t.artObj.content)}}),a("van-divider",[t._v("End")]),a("div",{staticClass:"like-box"},[1===t.artObj.attitude?a("van-button",{attrs:{icon:"good-job",type:"danger",size:"small"},on:{click:function(n){return t.attitudeFn(0)}}},[t._v("已点赞")]):a("van-button",{attrs:{icon:"good-job-o",type:"danger",plain:"",size:"small"},on:{click:function(n){return t.attitudeFn(1)}}},[t._v("点赞")])],1)],1),a("div",[a("CommentList")],1)],1)},i=[],o=a(4234),r=a(6165),s=function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",[a("div",{staticClass:"cmt-list"},[a("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多评论了，请发表评论","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(n){t.loading=n},expression:"loading"}},t._l(t.commentArr,(function(n){return a("div",{key:n.com_id,staticClass:"cmt-item"},[a("div",{staticClass:"cmt-header"},[a("div",{staticClass:"cmt-header-left"},[a("img",{staticClass:"avatar",attrs:{src:n.aut_photo}}),a("span",{staticClass:"uname"},[t._v(t._s(n.aut_name))])]),a("div",{staticClass:"cmt-header-right"},[n.is_liking?a("van-icon",{attrs:{name:"like",size:"16",color:"red"},on:{click:function(a){return t.islove(n,!1)}}}):a("van-icon",{attrs:{name:"like-o",size:"16",color:"gray"},on:{click:function(a){return t.islove(n,!0)}}})],1)]),a("div",{staticClass:"cmt-body",domProps:{innerHTML:t._s(n.content)}}),a("div",{staticClass:"cmt-footer"},[t._v(t._s(t._f("relativeTime")(n.pubdate)))])])})),0)],1),t.isShowCmtIpt?a("div",{staticClass:"cmt-box van-hairline--top"},[a("textarea",{directives:[{name:"fofo",rawName:"v-fofo"},{name:"model",rawName:"v-model.trim",value:t.comText,expression:"comText",modifiers:{trim:!0}}],attrs:{placeholder:"友善评论、理性发言、阳光心灵"},domProps:{value:t.comText},on:{blur:[t.blurFn,function(n){return t.$forceUpdate()}],input:function(n){n.target.composing||(t.comText=n.target.value.trim())}}}),a("van-button",{attrs:{type:"default",disabled:0===t.comText.length},on:{click:t.sendFn}},[t._v("发布")])],1):a("div",{staticClass:"add-cmt-box van-hairline--top"},[a("van-icon",{attrs:{name:"arrow-left",size:"0.48rem"},on:{click:function(n){return t.$router.back()}}}),a("div",{staticClass:"ipt-cmt-div",on:{click:t.toggleShowFn}},[t._v("发表评论")]),a("div",{staticClass:"icon-box"},[a("van-badge",{attrs:{content:0===t.total_count?"":t.total_count,max:"99"}},[a("van-icon",{attrs:{name:"comment-o",size:"0.53333334rem"},on:{click:t.commentFn}})],1),a("van-icon",{attrs:{name:"star-o",size:"0.53333334rem"}}),a("van-icon",{attrs:{name:"share-o",size:"0.53333334rem"}})],1)],1)])},c=[],l={name:"CommentList",data(){return{offset:null,commentArr:[],isShowCmtIpt:!1,total_count:0,comText:"",loading:!1,finished:!1,lastId:""}},async created(){const{data:t}=await(0,o.jS)({id:this.$route.query.art_id});this.commentArr=t.data.results,this.total_count=t.data.total_count,this.lastId=t.data.last_id,0===t.data.results.length&&(this.finished=!0)},methods:{async islove(t,n){t.is_liking=n,n?await(0,o.wR)(t.com_id):await(0,o.ih)(t.com_id)},toggleShowFn(){this.isShowCmtIpt=!this.isShowCmtIpt},commentFn(){document.querySelector(".like-box").scrollIntoView({behavior:"smooth"})},async sendFn(){const{data:t}=await(0,o.IJ)({id:this.$route.query.art_id,content:this.comText});this.total_count++,this.commentArr.unshift(t.data.new_obj),this.comText="",this.commentFn()},blurFn(){setTimeout((()=>{this.isShowCmtIpt=!1}),0)},async onLoad(){if(this.commentArr.length>0){const{data:t}=await(0,o.jS)({id:this.$route.query.art_id,offset:this.lastId});this.commentArr=[...this.commentArr,...t.data.results],this.total_count=t.data.total_count,this.lastId=t.data.last_id,this.loading=!1,null===t.data.last_id&&(this.finished=!0)}else this.loading=!1}}},u=l,d=a(1001),m=(0,d.Z)(u,s,c,!1,null,"a6c8cb3a",null),v=m.exports,f={name:"ArticleDetail",props:{art_id:{type:String,required:!0}},data(){return{artObj:{}}},async created(){const{data:t}=await(0,o.mx)(this.art_id);this.artObj=t.data},methods:{async followFn(t){this.artObj.is_followed=t,t?await(0,r.P_)(this.artObj.aut_id):await(0,r.wQ)(this.artObj.aut_id)},async attitudeFn(t){if(this.artObj.attitude=t,t){const{data:t}=await(0,o.HA)(this.artObj.art_id);console.log(t)}else{const{data:t}=await(0,o.Id)(this.artObj.art_id);console.log(t)}}},components:{CommentList:v}},_=f,h=(0,d.Z)(_,e,i,!1,null,"6f01d320",null),p=h.exports},4234:function(t,n,a){a.d(n,{HA:function(){return c},IJ:function(){return d},Id:function(){return l},X:function(){return r},Zz:function(){return i},ih:function(){return v},jS:function(){return u},mx:function(){return s},tH:function(){return o},wR:function(){return m}});var e=a(5972);const i=t=>e.Z.get("/v1_0/articles",{params:t}),o=t=>e.Z.post("/v1_0/article/dislikes",{target:t}),r=t=>e.Z.post("/v1_0/article/reports",t),s=t=>e.Z.get(`/v1_0/articles/${t}`),c=t=>e.Z.post("/v1_0/article/likings",{target:t}),l=t=>e.Z["delete"](`/v1_0/article/likings/${t}`),u=({id:t,offset:n=null,limit:a=10})=>e.Z.get("/v1_0/comments",{params:{type:"a",source:t,offset:n,limit:a}}),d=({id:t,content:n,artId:a=null})=>{const i={target:t,content:n,art_id:a};return a||(i.art_id=a),e.Z.post("/v1_0/comments",i)},m=t=>e.Z.post("/v1_0/comment/likings",{target:t}),v=t=>e.Z["delete"](`/v1_0/comment/likings/${t}`)},6165:function(t,n,a){a.d(n,{CA:function(){return d},P_:function(){return c},Q6:function(){return o},XN:function(){return m},bG:function(){return r},nP:function(){return u},vh:function(){return s},wQ:function(){return l},x4:function(){return i}});var e=a(5972);const i=t=>e.Z.post("/v1_0/authorizations",t),o=t=>e.Z.get(`/v1_0/sms/codes/${t}`),r=()=>e.Z.get("/v1_0/user"),s=()=>e.Z.get("/v1_0/user/channels"),c=t=>e.Z.post("/v1_0/user/followings",{target:t}),l=t=>e.Z["delete"](`/v1_0/user/followings/${t}`),u=()=>e.Z.get("/v1_0/user/profile"),d=t=>e.Z.patch("/v1_0/user/photo",t),m=t=>{const n={name:"",gender:0,birthday:"",real_name:"",intro:""};for(const a in n)void 0===t[a]?delete n[a]:n[a]=t[a];return e.Z.patch("/v1_0/user/profile",n)}}}]);
//# sourceMappingURL=391.03d0a27d.js.map