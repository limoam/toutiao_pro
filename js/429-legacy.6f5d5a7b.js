(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[429],{8414:function(t,e,n){"use strict";n.d(e,{Z:function(){return f}});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-cell",{attrs:{clickable:""}},[n("div",{staticClass:"title van-multi-ellipsis--l2",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.title))]),n("div",{attrs:{slot:"label"},slot:"label"},[3===t.article.cover.type?n("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(e,r){return n("van-image",{key:r,attrs:{fit:"cover",src:e,"lazy-load":""}},[n("van-loading",{attrs:{slot:"loading",type:"spinner",size:"20",vertical:""},slot:"loading"}),n("text",{attrs:{slot:"error"},slot:"error"},[t._v("加载失败")])],1)})),1):t._e(),n("div",{staticClass:"lable-info-wrap",class:{hide:!t.hide}},[n("span",[t._v(t._s(t.article.aut_name))]),n("span",[t._v(t._s(t.article.comm_count))]),n("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]),1===t.article.cover.type?n("van-image",{staticClass:"right-cover",attrs:{slot:"default",fit:"cover",src:t.article.cover.images[0],"lazy-load":""},slot:"default"},[n("van-loading",{attrs:{slot:"loading",type:"spinner",size:"20",vertical:""},slot:"loading"}),n("text",{attrs:{slot:"error"},slot:"error"},[t._v("加载失败")])],1):t._e(),t.hide?n("div",{staticClass:"toutiao toutiao-guanbi",attrs:{slot:"right-icon"},on:{click:function(e){e.stopPropagation(),t.show=!0}},slot:"right-icon"}):t._e()],1),n("van-action-sheet",{attrs:{actions:t.actions,"get-container":"body","cancel-text":t.bottomText,"lazy-render":""},on:{cancel:t.cancelFn,select:t.onSelect,close:t.closeFn},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}})],1)},a=[],i=n(6198),s=(n(8975),n(8309),[{name:"不感兴趣"},{name:"反馈垃圾内容"}]),o=[{value:0,name:"其他问题"},{value:1,name:"标题夸张"},{value:2,name:"色情低俗"},{value:3,name:"错别字多"},{value:4,name:"旧闻重复"},{value:5,name:"广告软文"},{value:6,name:"内容不实"},{value:7,name:"涉嫌违规犯罪"},{value:8,name:"侵权"}],c=n(4234),l={name:"ArticleItem",props:{article:{type:Object,required:!0},onRefresh:Function,hide:Boolean},data:function(){return{show:!1,actions:s,bottomText:"取消"}},methods:{onSelect:function(t){var e=this;return(0,i.Z)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("反馈垃圾内容"!==t.name){n.next=5;break}e.actions=o,e.bottomText="返回",n.next=28;break;case 5:if("不感兴趣"!==t.name){n.next=18;break}return n.prev=6,n.next=9,(0,c.tH)(e.article.art_id);case 9:e.$toast("将为您减少此类推荐"),e.onRefresh(),n.next=15;break;case 13:n.prev=13,n.t0=n["catch"](6);case 15:e.show=!1,n.next=28;break;case 18:return n.prev=18,n.next=21,(0,c.X)({target:e.article.art_id,type:t.value,remark:"无"});case 21:e.$toast("感谢您的反馈"),e.show=!1,e.onRefresh(),n.next=28;break;case 26:n.prev=26,n.t1=n["catch"](18);case 28:case"end":return n.stop()}}),n,null,[[6,13],[18,26]])})))()},cancelFn:function(){"返回"===this.bottomText&&(this.show=!0,this.actions=s,this.bottomText="取消")},closeFn:function(){this.actions=s,this.bottomText="取消"}}},u=l,d=n(1001),h=(0,d.Z)(u,r,a,!1,null,"28300ffe",null),f=h.exports},4429:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return I}});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home-container"},[n("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[n("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",size:"small",round:"",icon:"search"},on:{click:t.moveSearchPage},slot:"title"},[t._v("搜索")])],1),n("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return n("van-tab",{key:t.id,attrs:{title:t.name}},[n("ArticleList",{attrs:{channel:t}})],1)})),n("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),n("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isChannelEditShow=!0}},slot:"nav-right"},[n("i",{staticClass:"toutiao toutiao-gengduo"})])],2),n("van-popup",{style:{height:"87%"},attrs:{round:"",closeable:"",position:"bottom","lazy-render":""},on:{close:t.closeFn},model:{value:t.isChannelEditShow,callback:function(e){t.isChannelEditShow=e},expression:"isChannelEditShow"}},[n("ChannelEdit",{ref:"editRef",attrs:{myChannels:t.channels,active:t.active},on:{addChannels:t.addChannels,updateChannel:t.updateChannel,delChannel:t.delChannel}})],1)],1)},a=[],i=n(3019),s=n(6198),o=(n(7327),n(1539),n(1249),n(8309),n(4553),n(561),n(8975),n(6165)),c=n(5972),l=function(){return c.Z.get("/v1_0/channels")},u=function(t){return(0,c.Z)({method:"PUT",url:"/v1_0/user/channels",data:{channels:t}})},d=function(t){return(0,c.Z)({method:"DELETE",url:"/v1_0/user/channels/".concat(t)})},h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"articlelist-container"},[n("van-pull-refresh",{attrs:{"success-text":t.refreshSuccess,"success-duration":1e3},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e){return n("ArticleItem",{key:e.art_id,attrs:{article:e,onRefresh:t.onRefresh,hide:!0},nativeOn:{click:function(n){return t.detailFn(e.art_id)}}})})),1)],1)],1)},f=[],v=n(4479),m=n(4234),p=n(8414),g={name:"ArticleList",components:{ArticleItem:p.Z},props:{channel:{type:Object,required:!0}},data:function(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isLoading:!1,refreshSuccess:"刷新成功"}},methods:{onLoad:function(){var t=this;return(0,s.Z)(regeneratorRuntime.mark((function e(){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.Zz)({channel_id:t.channel.id,timestamp:t.timestamp||Date.now()});case 3:r=e.sent,a=r.data,(n=t.list).push.apply(n,(0,v.Z)(a.data.results)),t.loading=!1,a.data.pre_timestamp?t.timestamp=a.data.pre_timestamp:t.finished=!0,e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](0),t.$toast("加载文章失败，稍后重试"),t.error=!0,t.loading=!1;case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))()},onRefresh:function(){var t=this;return(0,s.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.timestamp=Date.now(),e.prev=1,e.next=4,(0,m.Zz)({channel_id:t.channel.id,timestamp:t.timestamp});case 4:n=e.sent,r=n.data,t.list=[],t.list=(0,v.Z)(r.data.results),t.refreshSuccess="刷新成功",t.timestamp=r.data.pre_timestamp,t.isLoading=!1,e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](1),t.isLoading=!1,t.refreshSuccess="刷新失败";case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))()},detailFn:function(t){this.$router.push({path:"/article_detail",query:{art_id:t}})}}},_=g,C=n(1001),x=(0,C.Z)(_,h,f,!1,null,"5073b399",null),b=x.exports,y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"channel-edit"},[n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),n("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(t._s(t.isEdit?"完成":"编辑"))])],1),n("van-grid",{staticClass:"my-grid",attrs:{"column-num":4,gutter:10}},t._l(t.myChannels,(function(e,r){return n("van-grid-item",{key:r,staticClass:"grid-item",on:{click:function(n){return t.onMychannelClick(e,r)}}},[n("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&!t.fiexChannels.includes(e.id),expression:"isEdit && !fiexChannels.includes(value.id)"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),n("span",{staticClass:"text",class:{active:r===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(e.name))])],1)})),1),n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("推荐频道")])]),n("van-grid",{staticClass:"recommend-grid",attrs:{"column-num":4,gutter:10}},t._l(t.recommendChannels,(function(e,r){return n("van-grid-item",{key:r,staticClass:"grid-item",attrs:{icon:"plus",text:e.name},on:{click:function(n){return t.onAddChannel(e)}}})})),1)],1)},w=[],k=(n(9653),n(6699),n(2023),{name:"ChannelEdit",props:{myChannels:{type:Array,required:!0},active:{type:Number,required:!0}},data:function(){return{allChannels:[],isEdit:!1,fiexChannels:[0]}},created:function(){this.loadAllChannels()},methods:{loadAllChannels:function(){var t=this;return(0,s.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l();case 3:n=e.sent,r=n.data,t.allChannels=r.data.channels,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},onAddChannel:function(t){this.$emit("addChannels",t)},onMychannelClick:function(t,e){this.isEdit?this.fiexChannels.includes(t.id)?this.$toast("推荐无法删除"):this.$emit("delChannel",t):this.$emit("updateChannel",e)}},computed:{recommendChannels:function(){var t=this;return this.allChannels.filter((function(e){return-1===t.myChannels.findIndex((function(t){return t.id===e.id}))}))}}}),Z=k,A=(0,C.Z)(Z,y,w,!1,null,"1177b5e5",null),E=A.exports,R={name:"HomeIndex",data:function(){return{active:0,channels:[],isChannelEditShow:!1}},methods:{loadChannels:function(){var t=this;return(0,s.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,o.vh)();case 3:n=e.sent,r=n.data,t.channels=r.data.channels,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$toast("获取频道列表数据失败");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},addChannels:function(t){var e=this;return(0,s.Z)(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.channels.filter((function(t){return 0!==t.id})),a=r.map((function(t,e){var n=(0,i.Z)({},t);return delete n.name,n.seq=e,n})),n.next=4,u(a);case 4:e.channels.push(t);case 5:case"end":return n.stop()}}),n)})))()},updateChannel:function(t){this.active=t,this.isChannelEditShow=!1},delChannel:function(t){var e=this;return(0,s.Z)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.channels.findIndex((function(e){return t.id===e.id})),e.channels.splice(r,1),n.next=4,d(t.id);case 4:case"end":return n.stop()}}),n)})))()},closeFn:function(){this.$refs.editRef.isEdit=!1},moveSearchPage:function(){this.$router.push("/search")}},created:function(){this.loadChannels()},components:{ArticleList:b,ChannelEdit:E}},S=R,$=(0,C.Z)(S,r,a,!1,null,"e3a28e62",null),I=$.exports},4553:function(t,e,n){"use strict";var r=n(2109),a=n(2092).findIndex,i=n(1223),s="findIndex",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),r({target:"Array",proto:!0,forced:o},{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),i(s)},1038:function(t,e,n){var r=n(2109),a=n(8457),i=n(7072),s=!i((function(t){Array.from(t)}));r({target:"Array",stat:!0,forced:s},{from:a})},6699:function(t,e,n){"use strict";var r=n(2109),a=n(1318).includes,i=n(7293),s=n(1223),o=i((function(){return!Array(1).includes()}));r({target:"Array",proto:!0,forced:o},{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),s("includes")},2023:function(t,e,n){"use strict";var r=n(2109),a=n(1702),i=n(3929),s=n(4488),o=n(1340),c=n(4964),l=a("".indexOf);r({target:"String",proto:!0,forced:!c("includes")},{includes:function(t){return!!~l(o(s(this)),o(i(t)),arguments.length>1?arguments[1]:void 0)}})},4234:function(t,e,n){"use strict";n.d(e,{HA:function(){return c},IJ:function(){return d},Id:function(){return l},X:function(){return s},Zz:function(){return a},ih:function(){return f},jS:function(){return u},mx:function(){return o},tH:function(){return i},wR:function(){return h}});var r=n(5972),a=function(t){return r.Z.get("/v1_0/articles",{params:t})},i=function(t){return r.Z.post("/v1_0/article/dislikes",{target:t})},s=function(t){return r.Z.post("/v1_0/article/reports",t)},o=function(t){return r.Z.get("/v1_0/articles/".concat(t))},c=function(t){return r.Z.post("/v1_0/article/likings",{target:t})},l=function(t){return r.Z["delete"]("/v1_0/article/likings/".concat(t))},u=function(t){var e=t.id,n=t.offset,a=void 0===n?null:n,i=t.limit,s=void 0===i?10:i;return r.Z.get("/v1_0/comments",{params:{type:"a",source:e,offset:a,limit:s}})},d=function(t){var e=t.id,n=t.content,a=t.artId,i=void 0===a?null:a,s={target:e,content:n,art_id:i};return i||(s.art_id=i),r.Z.post("/v1_0/comments",s)},h=function(t){return r.Z.post("/v1_0/comment/likings",{target:t})},f=function(t){return r.Z["delete"]("/v1_0/comment/likings/".concat(t))}},6165:function(t,e,n){"use strict";n.d(e,{CA:function(){return d},P_:function(){return c},Q6:function(){return i},XN:function(){return h},bG:function(){return s},nP:function(){return u},vh:function(){return o},wQ:function(){return l},x4:function(){return a}});var r=n(5972),a=function(t){return r.Z.post("/v1_0/authorizations",t)},i=function(t){return r.Z.get("/v1_0/sms/codes/".concat(t))},s=function(){return r.Z.get("/v1_0/user")},o=function(){return r.Z.get("/v1_0/user/channels")},c=function(t){return r.Z.post("/v1_0/user/followings",{target:t})},l=function(t){return r.Z["delete"]("/v1_0/user/followings/".concat(t))},u=function(){return r.Z.get("/v1_0/user/profile")},d=function(t){return r.Z.patch("/v1_0/user/photo",t)},h=function(t){var e={name:"",gender:0,birthday:"",real_name:"",intro:""};for(var n in e)void 0===t[n]?delete e[n]:e[n]=t[n];return r.Z.patch("/v1_0/user/profile",e)}},4479:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t){if(Array.isArray(t))return r(t)}n.d(e,{Z:function(){return c}});n(2526),n(1817),n(1539),n(2165),n(8783),n(3948),n(1038);function i(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n(7042),n(8309),n(4916),n(7601);function s(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}n(1703);function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return a(t)||i(t)||s(t)||o()}}}]);
//# sourceMappingURL=429-legacy.6f5d5a7b.js.map