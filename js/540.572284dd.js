"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[540],{3540:function(t,e,a){a.r(e),a.d(e,{default:function(){return f}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-edit-container"},[a("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"编辑资料","left-arrow":"",fixed:"",border:!1},on:{"click-left":function(e){return t.$router.back()}}}),a("van-cell-group",{staticClass:"action-card"},[a("van-cell",{attrs:{title:"头像","is-link":"",center:""},scopedSlots:t._u([{key:"default",fn:function(){return[a("van-image",{staticClass:"avatar",attrs:{round:"",src:t.$store.state.avatar},on:{click:function(e){return t.$refs.iptFile.click()}}}),a("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"iptFile",attrs:{type:"file",accept:"image/*"},on:{change:t.onFileChange}})]},proxy:!0}])}),a("van-cell",{attrs:{title:"名称","is-link":"",value:t.profileObj.name},on:{click:t.editNameFn}}),a("van-cell",{attrs:{title:"生日","is-link":"",value:t.profileObj.birthday},on:{click:t.editBirthday}})],1),a("van-dialog",{attrs:{title:"标题","show-cancel-button":"",beforeClose:t.beforeCloseFn},scopedSlots:t._u([{key:"default",fn:function(){return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.editName,expression:"editName"},{name:"fofo",rawName:"v-fofo"}],attrs:{type:"text"},domProps:{value:t.editName},on:{input:function(e){e.target.composing||(t.editName=e.target.value)}}})]},proxy:!0}]),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}}),a("van-popup",{style:{height:"50%"},attrs:{position:"bottom",round:"","get-container":".user-edit-container"},model:{value:t.birShow,callback:function(e){t.birShow=e},expression:"birShow"}},[a("van-datetime-picker",{attrs:{type:"date",title:"选择年月日","min-date":t.minDate,"max-date":t.maxDate},on:{cancel:function(e){t.birShow=!1},confirm:t.confirmFn},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1)],1)},i=[],r=a(6165),o=a(5796),s={name:"UserEdit",data(){return{profileObj:{},show:!1,editName:"",birShow:!1,minDate:new Date(1922,0,1),maxDate:new Date,currentDate:new Date(2022,4,26)}},async created(){const{data:t}=await(0,r.nP)();console.log(t),this.profileObj=t.data},methods:{async onFileChange(t){if(0===t.target.files.length)return;const e=new FormData;e.append("photo",t.target.files[0]);const{data:a}=await(0,r.CA)(e);this.$store.commit("setAvatar",a.data.photo)},editNameFn(){this.show=!0,this.editName=this.profileObj.name},async beforeCloseFn(t,e){if("confirm"===t){const t=/^[A-Za-z0-9\u4e00-\u9fa5]{1,7}$/;t.test(this.editName)?(this.profileObj.name=this.editName,await(0,r.XN)({name:this.editName}),this.$toast("修改成功"),e()):(this.$notify({type:"warning",message:"用户名格式有误，只能是中英文数字混合1到7位"}),e(!1))}else e()},async editBirthday(){this.birShow=!0,this.currentDate=new Date(this.profileObj.birthday)},async confirmFn(){const{data:t}=await(0,r.XN)({birthday:(0,o.p)(this.currentDate)});this.profileObj.birthday=(0,o.p)(this.currentDate),this.birShow=!1,this.$toast("修改成功"),console.log(t)}}},c=s,l=a(1001),u=(0,l.Z)(c,n,i,!1,null,"cd0d8d14",null),f=u.exports},6165:function(t,e,a){a.d(e,{CA:function(){return f},P_:function(){return c},Q6:function(){return r},XN:function(){return d},bG:function(){return o},nP:function(){return u},vh:function(){return s},wQ:function(){return l},x4:function(){return i}});var n=a(5972);const i=t=>n.Z.post("/v1_0/authorizations",t),r=t=>n.Z.get(`/v1_0/sms/codes/${t}`),o=()=>n.Z.get("/v1_0/user"),s=()=>n.Z.get("/v1_0/user/channels"),c=t=>n.Z.post("/v1_0/user/followings",{target:t}),l=t=>n.Z["delete"](`/v1_0/user/followings/${t}`),u=()=>n.Z.get("/v1_0/user/profile"),f=t=>n.Z.patch("/v1_0/user/photo",t),d=t=>{const e={name:"",gender:0,birthday:"",real_name:"",intro:""};for(const a in e)void 0===t[a]?delete e[a]:e[a]=t[a];return n.Z.patch("/v1_0/user/profile",e)}}}]);
//# sourceMappingURL=540.572284dd.js.map