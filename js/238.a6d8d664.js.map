{"version":3,"file":"js/238.a6d8d664.js","mappings":"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","sources":["webpack://toutiao-m/./src/views/search/index.vue?7343","webpack://toutiao-m/src/views/search/index.vue","webpack://toutiao-m/./src/views/search/index.vue?f0c1","webpack://toutiao-m/./src/views/search/index.vue","webpack://toutiao-m/./src/api/search.js"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"search-container\"},[_c('van-nav-bar',{staticClass:\"page-nav-bar\",attrs:{\"left-arrow\":\"\",\"border\":false},on:{\"click-left\":_vm.onClickLeft},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('van-search',{directives:[{name:\"fofo\",rawName:\"v-fofo\"}],attrs:{\"placeholder\":\"请输入搜索关键词\"},on:{\"input\":_vm.searchFn,\"search\":_vm.searchVal},model:{value:(_vm.value),callback:function ($$v) {_vm.value=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"value\"}})]},proxy:true}])}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.value),expression:\"value\"}],staticClass:\"sugg-list\"},_vm._l((_vm.suggestList),function(item,index){return _c('div',{key:index,staticClass:\"sugg-item\",domProps:{\"innerHTML\":_vm._s(_vm.lightFn(item, _vm.value))},on:{\"click\":function($event){return _vm.searchSuggest(item)}}})}),0),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.value && _vm.history.length),expression:\"!value && history.length\"}],staticClass:\"search-history\"},[_c('van-cell',{attrs:{\"title\":\"搜索历史\"},scopedSlots:_vm._u([{key:\"right-icon\",fn:function(){return [_c('van-icon',{staticClass:\"search-icon\",attrs:{\"name\":\"delete\"},on:{\"click\":_vm.clearHistory}})]},proxy:true}])}),_c('van-grid',{attrs:{\"column-num\":3,\"gutter\":15,\"direction\":\"horizontal\",\"border\":false}},_vm._l((_vm.history),function(value,index){return _c('van-grid-item',{key:index,attrs:{\"text\":value},on:{\"click\":function($event){return _vm.searchHistory(value)}}})}),1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"search-container\">\r\n    <!-- 搜索头部 -->\r\n    <van-nav-bar left-arrow @click-left=\"onClickLeft\" class=\"page-nav-bar\" :border=\"false\">\r\n      <template #title>\r\n        <van-search v-model.trim=\"value\" placeholder=\"请输入搜索关键词\" v-fofo @input=\"searchFn\" @search=\"searchVal\" />\r\n      </template>\r\n    </van-nav-bar>\r\n    <!-- 搜索关联列表 -->\r\n    <div class=\"sugg-list\" v-show=\"value\">\r\n      <div class=\"sugg-item\" v-for=\"(item, index) in suggestList\" :key=\"index\" v-html=\"lightFn(item, value)\" @click=\"searchSuggest(item)\"></div>\r\n    </div>\r\n\r\n    <!-- 历史记录 -->\r\n    <div class=\"search-history\" v-show=\"!value && history.length\">\r\n      <van-cell title=\"搜索历史\">\r\n        <template #right-icon>\r\n          <van-icon name=\"delete\" class=\"search-icon\" @click=\"clearHistory\" />\r\n        </template>\r\n      </van-cell>\r\n      <van-grid :column-num=\"3\" :gutter=\"15\" direction=\"horizontal\" :border=\"false\">\r\n        <van-grid-item v-for=\"(value, index) in history\" :key=\"index\" :text=\"value\" @click=\"searchHistory(value)\" />\r\n      </van-grid>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 跳转搜索页面\r\n// 输入框回车\r\n// 点击联想行\r\n// 点击历史记录\r\nimport { suggest } from '@/api/search'\r\nexport default {\r\n  name: 'SearchIndex',\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.replace('/home')\r\n    },\r\n    // 输入框内筒改变触发\r\n    searchFn() {\r\n      // console.log(this.value)\r\n      clearTimeout(this.timer)\r\n      // 防抖\r\n      if (this.value.length <= 0) {\r\n        this.suggestList = []\r\n      } else {\r\n        this.timer = setTimeout(async() => {\r\n          const { data: res } = await suggest(this.value)\r\n          this.suggestList = res.data.options\r\n          // console.log(res)\r\n        }, 500)\r\n      }\r\n    },\r\n    // 处理字符串高亮\r\n    lightFn(originStr, target) {\r\n      // originStr原来的字符串，target关键字\r\n      // 返回值替换后的完整字符串\r\n      // 插值表达式只是一个字符串，用v-html\r\n      try {\r\n        // 使用变量作为正则匹配条件，不能用语法糖简化写法\r\n        const reg = new RegExp(target, 'ig') // i忽略大小写，g全局都匹配\r\n        // return originStr.replace(reg, `<span style=\"color: tomato;\">${target}</span>`)\r\n        return originStr.replace(reg, (match) => {\r\n          // match就是匹配中时，原字符串里的那个字符，用人家原来的，我们只给个颜色即可\r\n          return `<span style=\"color: tomato;\">${match}</span>`\r\n        })\r\n      } catch (err) {}\r\n    },\r\n    // 跳转结果页面\r\n    gotoFn(val) {\r\n      this.$nextTick(function() {\r\n        this.$router.push({\r\n          name: 'searchResult',\r\n          params: { value: val }\r\n        })\r\n      })\r\n    },\r\n    // 搜索确认跳转\r\n    searchVal() {\r\n      // 保存关键字\r\n      if (this.value) {\r\n        this.history.push(this.value)\r\n        // 路由跳转在watch之前执行，watch也是异步任务，所以异步跳转\r\n        this.gotoFn(this.value)\r\n      }\r\n    },\r\n    // 关联跳转\r\n    searchSuggest(val) {\r\n      if (val) {\r\n        this.history.push(val)\r\n        this.gotoFn(val)\r\n      }\r\n    },\r\n    // 历史记录跳转\r\n    searchHistory(val) {\r\n      this.gotoFn(val)\r\n    },\r\n    // 清空历史记录\r\n    clearHistory() {\r\n      this.history = []\r\n      this.$toast('历史记录已清除')\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      value: '', // 搜索关键字\r\n      timer: null, // 防抖定时器\r\n      suggestList: [], // 联想数据\r\n      history: JSON.parse(localStorage.getItem('hist')) || [] // 搜索历史\r\n    }\r\n  },\r\n  watch: {\r\n    history: {\r\n      deep: true,\r\n      handler(val) {\r\n        // 没有语法糖，只能这样写，去重完再转化回来,如果值为对象，保存的是对象地址\r\n        const newSet = new Set(val)\r\n        const newArr = Array.from(newSet)\r\n        localStorage.setItem('hist', JSON.stringify(newArr))\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.search-container {\r\n  /deep/.page-nav-bar {\r\n    .van-icon-arrow-left {\r\n      color: #fff;\r\n    }\r\n    .van-nav-bar__title {\r\n      margin-left: 13%;\r\n      min-width: 80%;\r\n      display: flex;\r\n      justify-content: center;\r\n      .van-search {\r\n        width: 100%;\r\n        height: 65px;\r\n        padding: 0;\r\n        border-radius: 45px;\r\n        overflow: hidden;\r\n      }\r\n    }\r\n  }\r\n  .sugg-list {\r\n    height: 93vh;\r\n    overflow-y: auto;\r\n    .sugg-item {\r\n      background-color: #fff;\r\n      padding: 0 45px;\r\n      // border-bottom: 1px solid #ccc;\r\n      font-size: 30px;\r\n      line-height: 110px;\r\n      .van-grid-item__text {\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      &:last-child {\r\n        border: none;\r\n      }\r\n      &:hover {\r\n        background-color: #eeeeee;\r\n      }\r\n    }\r\n  }\r\n  /deep/.search-history {\r\n    .van-cell {\r\n      background-color: #f5f7f9;\r\n      .van-cell__title {\r\n        font-size: 38px;\r\n        font-weight: 500;\r\n      }\r\n    }\r\n    .van-grid {\r\n      padding-top: 35px;\r\n      .van-grid-item {\r\n        // width: 150px;\r\n        height: 54px;\r\n        .van-grid-item__content {\r\n          margin-bottom: 20px;\r\n          background-color: #e9e9e9;\r\n          border-radius: 60px;\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n          &:hover {\r\n            background-color: #e1e1e1;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    .van-icon {\r\n      height: auto;\r\n      line-height: 54px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=0c757300&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0c757300&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0c757300\",\n  null\n  \n)\n\nexport default component.exports","// 搜索接口\r\nimport request from '@/utils/request'\r\n\r\n// 关联\r\nexport const suggest = (q) =>\r\n  request.get('/v1_0/suggestion', {\r\n    params: { q }\r\n  })\r\n// 搜索结果\r\nexport const searchResult = ({ page = 1, q }) =>\r\n  request.get('/v1_0/search', {\r\n    params: {\r\n      page,\r\n      per_page: 10,\r\n      q\r\n    }\r\n  })\r\n"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","onClickLeft","scopedSlots","_u","key","fn","directives","name","rawName","searchFn","searchVal","model","value","callback","$$v","trim","expression","proxy","_l","item","index","domProps","_s","lightFn","$event","searchSuggest","history","length","clearHistory","searchHistory","staticRenderFns","methods","clearTimeout","data","gotoFn","params","timer","suggestList","watch","deep","handler","localStorage","component","suggest","q","request","searchResult","page","per_page"],"sourceRoot":""}